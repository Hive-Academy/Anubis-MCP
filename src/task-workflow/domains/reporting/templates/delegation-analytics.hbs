{{!-- Delegation Analytics Report Template --}}
{{!-- Purpose: Deep dive into delegation patterns, handoff efficiency, and role performance --}}

{{#> layouts/base 
    title="üîÑ Delegation Analytics" 
    subtitle="Delegation Patterns & Role Efficiency Analysis"
    headerIcon="üîÑ"
    reportType="delegation_analytics"
    generatedAt=generatedAt
    dateRange=dateRange
}}

{{#*inline "additionalStyles"}}
<style>
    .delegation-flow-section {
        @apply bg-gray-800 border border-gray-700 rounded-xl p-8 mb-8;
    }
    
    .flow-visualization {
        @apply flex justify-between items-center bg-gray-750 rounded-xl p-8 my-6 overflow-x-auto;
        min-width: 800px;
    }
    
    .role-node {
        @apply text-center p-6 rounded-xl min-w-[120px] relative transition-transform duration-300;
    }
    
    .role-node:hover {
        @apply scale-105;
    }
    
    .role-node.boomerang {
        @apply bg-gradient-to-br from-blue-500 to-blue-700 text-white;
    }
    
    .role-node.researcher {
        @apply bg-gradient-to-br from-green-500 to-green-700 text-white;
    }
    
    .role-node.architect {
        @apply bg-gradient-to-br from-yellow-500 to-yellow-700 text-white;
    }
    
    .role-node.senior-developer {
        @apply bg-gradient-to-br from-purple-500 to-purple-700 text-white;
    }
    
    .role-node.code-review {
        @apply bg-gradient-to-br from-red-500 to-red-700 text-white;
    }
    
    .role-title {
        @apply font-semibold text-sm mb-2 uppercase tracking-wide;
    }
    
    .role-count {
        @apply text-2xl font-bold mb-2;
    }
    
    .role-efficiency {
        @apply text-xs opacity-90;
    }
    
    .flow-arrow {
        @apply text-2xl text-gray-400 mx-4 animate-pulse;
    }
    
    .delegation-metrics-grid {
        @apply grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8;
    }
    
    .delegation-metric-card {
        @apply bg-gray-750 border border-gray-700 rounded-xl p-6 transition-all duration-300 hover:-translate-y-1 hover:shadow-xl;
    }
    
    .metric-header {
        @apply flex justify-between items-center mb-4;
    }
    
    .metric-icon {
        @apply text-xl;
    }
    
    .metric-trend {
        @apply text-xs px-2 py-1 rounded font-semibold;
    }
    
    .trend-up {
        @apply bg-green-500/10 text-green-400;
    }
    
    .trend-down {
        @apply bg-red-500/10 text-red-400;
    }
    
    .trend-stable {
        @apply bg-gray-500/10 text-gray-400;
    }
    
    .metric-value {
        @apply text-3xl font-bold mb-2;
    }
    
    .metric-value.success { @apply text-green-400; }
    .metric-value.warning { @apply text-yellow-400; }
    .metric-value.danger { @apply text-red-400; }
    .metric-value.info { @apply text-blue-400; }
    
    .metric-label {
        @apply text-gray-400 text-sm font-medium;
    }
    
    .bottleneck-analysis {
        @apply bg-gradient-to-br from-yellow-500/10 to-yellow-600/5 border border-yellow-500 rounded-xl p-8 my-8;
    }
    
    .bottleneck-title {
        @apply text-yellow-400 text-xl font-semibold mb-6 flex items-center gap-2;
    }
    
    .bottleneck-item {
        @apply bg-gray-800 rounded-lg p-6 mb-4 border-l-4 border-yellow-500;
    }
    
    .bottleneck-role {
        @apply font-semibold text-white mb-2;
    }
    
    .bottleneck-issue {
        @apply text-gray-400 mb-3 leading-relaxed;
    }
    
    .bottleneck-impact {
        @apply inline-block px-3 py-1 rounded text-xs font-semibold uppercase tracking-wide;
    }
    
    .impact-high {
        @apply bg-red-500/10 text-red-400;
    }
    
    .impact-medium {
        @apply bg-yellow-500/10 text-yellow-400;
    }
    
    .impact-low {
        @apply bg-green-500/10 text-green-400;
    }
    
    .transition-matrix {
        @apply bg-gray-800 border border-gray-700 rounded-xl p-8 my-8 overflow-x-auto;
    }
    
    .matrix-title {
        @apply text-white text-xl font-semibold mb-6;
    }
    
    .matrix-table {
        @apply w-full border-collapse min-w-[600px];
    }
    
    .matrix-table th,
    .matrix-table td {
        @apply p-4 text-center border border-gray-700;
    }
    
    .matrix-table th {
        @apply bg-gray-750 text-white font-semibold text-sm;
    }
    
    .matrix-table td {
        @apply bg-gray-800 text-gray-400;
    }
    
    .transition-count {
        @apply font-semibold text-white;
    }
    
    .transition-high {
        @apply bg-green-500/10 text-green-400;
    }
    
    .transition-medium {
        @apply bg-yellow-500/10 text-yellow-400;
    }
    
    .transition-low {
        @apply bg-gray-500/10 text-gray-400;
    }
    
    .efficiency-indicators {
        @apply grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6 my-8;
    }
    
    .efficiency-card {
        @apply bg-gray-750 border border-gray-700 rounded-xl p-6 text-center transition-all duration-300 hover:-translate-y-1 hover:border-blue-500;
    }
    
    .efficiency-score {
        @apply text-3xl font-bold mb-2;
    }
    
    .efficiency-label {
        @apply text-sm text-gray-400 font-medium;
    }
    
    .chart-container {
        @apply bg-gray-800 border border-gray-700 rounded-xl p-6 mb-8;
    }
    
    .chart-title {
        @apply text-white text-lg font-semibold mb-4;
    }
    
    .chart-canvas {
        @apply w-full h-80;
    }
</style>
{{/inline}}

{{#*inline "content"}}
<div class="space-y-8">
    <!-- Delegation Flow Visualization -->
    <div class="delegation-flow-section">
        <h3 class="text-xl font-semibold text-white mb-6">üåä Delegation Flow Visualization</h3>
        <div class="overflow-x-auto">
            <div class="flow-visualization">
                <div class="role-node boomerang">
                    <div class="role-title">ü™É Boomerang</div>
                    <div class="role-count">{{default metrics.delegations.roleStats.boomerang 0}}</div>
                    <div class="role-efficiency">
                        {{formatPercentage (multiply (default metrics.delegations.roleEfficiency.boomerang 0) 100)}}% efficiency
                    </div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="role-node researcher">
                    <div class="role-title">üî¨ Researcher</div>
                    <div class="role-count">{{default metrics.delegations.roleStats.researcher 0}}</div>
                    <div class="role-efficiency">
                        {{formatPercentage (multiply (default metrics.delegations.roleEfficiency.researcher 0) 100)}}% efficiency
                    </div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="role-node architect">
                    <div class="role-title">üèõÔ∏è Architect</div>
                    <div class="role-count">{{default metrics.delegations.roleStats.architect 0}}</div>
                    <div class="role-efficiency">
                        {{formatPercentage (multiply (default metrics.delegations.roleEfficiency.architect 0) 100)}}% efficiency
                    </div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="role-node senior-developer">
                    <div class="role-title">üë®‚Äçüíª Developer</div>
                    <div class="role-count">{{default metrics.delegations.roleStats.senior-developer 0}}</div>
                    <div class="role-efficiency">
                        {{formatPercentage (multiply (default metrics.delegations.roleEfficiency.senior-developer 0) 100)}}% efficiency
                    </div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="role-node code-review">
                    <div class="role-title">üîç Code Review</div>
                    <div class="role-count">{{default metrics.delegations.roleStats.code-review 0}}</div>
                    <div class="role-efficiency">
                        {{formatPercentage (multiply (default metrics.delegations.roleEfficiency.code-review 0) 100)}}% efficiency
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Delegation Metrics -->
    <div class="delegation-metrics-grid">
        <div class="delegation-metric-card">
            <div class="metric-header">
                <div class="metric-icon">üéØ</div>
                <div class="metric-trend trend-up">‚Üó +12%</div>
            </div>
            <div class="metric-value success">{{formatPercentage (default metrics.delegations.successRate 0)}}%</div>
            <div class="metric-label">Delegation Success Rate</div>
        </div>

        <div class="delegation-metric-card">
            <div class="metric-header">
                <div class="metric-icon">‚ö°</div>
                <div class="metric-trend trend-down">‚Üò -8%</div>
            </div>
            <div class="metric-value info">{{formatNumber (default metrics.delegations.avgHandoffTime 0)}}h</div>
            <div class="metric-label">Avg Handoff Time</div>
        </div>

        <div class="delegation-metric-card">
            <div class="metric-header">
                <div class="metric-icon">üîÑ</div>
                <div class="metric-trend trend-stable">‚Üí Stable</div>
            </div>
            <div class="metric-value warning">{{formatNumber (default metrics.delegations.avgRedelegationCount 0)}}</div>
            <div class="metric-label">Avg Redelegations</div>
        </div>

        <div class="delegation-metric-card">
            <div class="metric-header">
                <div class="metric-icon">üìä</div>
                <div class="metric-trend trend-up">‚Üó +5%</div>
            </div>
            <div class="metric-value info">{{default metrics.delegations.totalDelegations 0}}</div>
            <div class="metric-label">Total Delegations</div>
        </div>

        <div class="delegation-metric-card">
            <div class="metric-header">
                <div class="metric-icon">‚è±Ô∏è</div>
                <div class="metric-trend trend-down">‚Üò -15%</div>
            </div>
            <div class="metric-value success">{{formatNumber (default metrics.delegations.avgCompletionTime 0)}}h</div>
            <div class="metric-label">Avg Role Completion Time</div>
        </div>

        <div class="delegation-metric-card">
            <div class="metric-header">
                <div class="metric-icon">üèÜ</div>
                <div class="metric-trend trend-up">‚Üó +18%</div>
            </div>
            <div class="metric-value success">{{default metrics.delegations.mostEfficientRole 'N/A'}}</div>
            <div class="metric-label">Most Efficient Role</div>
        </div>
    </div>

    <!-- Delegation Flow Chart -->
    <div class="chart-container">
        <h3 class="chart-title">üìà Delegation Flow Trends</h3>
        <canvas id="delegationFlowChart" class="chart-canvas"></canvas>
    </div>

    <!-- Role Efficiency Chart -->
    <div class="chart-container">
        <h3 class="chart-title">‚ö° Role Efficiency Comparison</h3>
        <canvas id="roleEfficiencyChart" class="chart-canvas"></canvas>
    </div>

    <!-- Bottleneck Analysis -->
    {{#if metrics.delegations.bottlenecks}}
    {{#if (gt (length metrics.delegations.bottlenecks) 0)}}
    <div class="bottleneck-analysis">
        <div class="bottleneck-title">
            ‚ö†Ô∏è Workflow Bottleneck Analysis
        </div>
        {{#each metrics.delegations.bottlenecks}}
            <div class="bottleneck-item">
                <div class="bottleneck-role">{{this.role}}</div>
                <div class="bottleneck-issue">{{this.issue}}</div>
                <div class="bottleneck-impact impact-{{this.impact}}">
                    {{this.impact}} Impact
                </div>
            </div>
        {{/each}}
    </div>
    {{/if}}
    {{/if}}

    <!-- Role Transition Matrix -->
    <div class="transition-matrix">
        <div class="matrix-title">üîÄ Role Transition Matrix</div>
        <table class="matrix-table">
            <thead>
                <tr>
                    <th>From / To</th>
                    <th>ü™É Boomerang</th>
                    <th>üî¨ Researcher</th>
                    <th>üèõÔ∏è Architect</th>
                    <th>üë®‚Äçüíª Developer</th>
                    <th>üîç Code Review</th>
                </tr>
            </thead>
            <tbody>
                {{#each (array 'boomerang' 'researcher' 'architect' 'senior-developer' 'code-review')}}
                    <tr>
                        <td><strong>{{this}}</strong></td>
                        {{#each (array 'boomerang' 'researcher' 'architect' 'senior-developer' 'code-review')}}
                            {{#with (lookup ../metrics.delegations.transitionMatrix ../this)}}
                                {{#with (lookup this @this)}}
                                    <td class="transition-count transition-{{#if (gt this 10)}}high{{else}}{{#if (gt this 5)}}medium{{else}}low{{/if}}{{/if}}">{{this}}</td>
                                {{else}}
                                    <td class="transition-count transition-low">0</td>
                                {{/with}}
                            {{else}}
                                <td class="transition-count transition-low">0</td>
                            {{/with}}
                        {{/each}}
                    </tr>
                {{/each}}
            </tbody>
        </table>
    </div>

    <!-- Efficiency Indicators -->
    <div>
        <h3 class="text-xl font-semibold text-white mb-6">üìà Role Efficiency Indicators</h3>
        <div class="efficiency-indicators">
            {{#each (array 'boomerang' 'researcher' 'architect' 'senior-developer' 'code-review')}}
                {{#with (lookup ../metrics.delegations.roleEfficiency this)}}
                    {{#with (multiply this 100)}}
                        <div class="efficiency-card">
                            <div class="efficiency-score {{#if (gt this 80)}}text-green-400{{else}}{{#if (gt this 60)}}text-yellow-400{{else}}text-red-400{{/if}}{{/if}}">
                                {{formatPercentage this}}%
                            </div>
                            <div class="efficiency-label">{{uppercase (replace ../this '-' ' ')}}</div>
                        </div>
                    {{/with}}
                {{else}}
                    <div class="efficiency-card">
                        <div class="efficiency-score text-gray-400">0.0%</div>
                        <div class="efficiency-label">{{uppercase (replace this '-' ' ')}}</div>
                    </div>
                {{/with}}
            {{/each}}
        </div>
    </div>

    <!-- Key Insights -->
    <div class="bg-gray-800 border border-gray-700 rounded-xl p-8">
        <div class="flex items-center gap-3 mb-6">
            <span class="text-2xl">üí°</span>
            <h3 class="text-xl font-semibold text-white">Delegation Insights</h3>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {{#with metrics.delegations.successRate}}
                {{#if (gt this 85)}}
                    <div class="bg-green-500/10 border border-green-500 rounded-lg p-6">
                        <div class="text-green-400 font-semibold mb-2">üéâ Excellent Delegation Flow</div>
                        <div class="text-gray-300 text-sm">
                            High success rate of {{formatPercentage this}}% indicates smooth role transitions and clear handoffs.
                        </div>
                    </div>
                {{else if (gt this 70)}}
                    <div class="bg-yellow-500/10 border border-yellow-500 rounded-lg p-6">
                        <div class="text-yellow-400 font-semibold mb-2">üìà Good Delegation Performance</div>
                        <div class="text-gray-300 text-sm">
                            Success rate of {{formatPercentage this}}% shows solid delegation patterns with room for optimization.
                        </div>
                    </div>
                {{else}}
                    <div class="bg-red-500/10 border border-red-500 rounded-lg p-6">
                        <div class="text-red-400 font-semibold mb-2">‚ö†Ô∏è Delegation Issues Detected</div>
                        <div class="text-gray-300 text-sm">
                            Low success rate of {{formatPercentage this}}% suggests delegation bottlenecks need immediate attention.
                        </div>
                    </div>
                {{/if}}
            {{/with}}
            
            {{#with metrics.delegations.avgRedelegationCount}}
                {{#if (lt this 1.5)}}
                    <div class="bg-green-500/10 border border-green-500 rounded-lg p-6">
                        <div class="text-green-400 font-semibold mb-2">‚úÖ Minimal Redelegations</div>
                        <div class="text-gray-300 text-sm">
                            Low redelegation rate of {{formatNumber this}} indicates clear requirements and effective handoffs.
                        </div>
                    </div>
                {{else if (gt this 2.5)}}
                    <div class="bg-yellow-500/10 border border-yellow-500 rounded-lg p-6">
                        <div class="text-yellow-400 font-semibold mb-2">üîÑ High Redelegation Rate</div>
                        <div class="text-gray-300 text-sm">
                            Average of {{formatNumber this}} redelegations suggests unclear requirements or quality issues.
                        </div>
                    </div>
                {{/if}}
            {{/with}}
            
            {{#if metrics.delegations.mostEfficientRole}}
                <div class="bg-blue-500/10 border border-blue-500 rounded-lg p-6">
                    <div class="text-blue-400 font-semibold mb-2">üèÜ Top Performing Role</div>
                    <div class="text-gray-300 text-sm">
                        {{uppercase (replace metrics.delegations.mostEfficientRole '-' ' ')}} shows highest efficiency - consider analyzing their practices for workflow optimization.
                    </div>
                </div>
            {{/if}}
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Delegation Flow Trends Chart
    const delegationFlowCtx = document.getElementById('delegationFlowChart').getContext('2d');
    new Chart(delegationFlowCtx, {
        type: 'line',
        data: {
            labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
            datasets: [{
                label: 'Successful Delegations',
                data: [{{default metrics.delegations.weeklyTrends.successful '[12, 15, 18, 22]'}},
                borderColor: '#10b981',
                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                tension: 0.4
            }, {
                label: 'Failed Delegations',
                data: [{{default metrics.delegations.weeklyTrends.failed '[3, 2, 4, 1]'}},
                borderColor: '#ef4444',
                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    labels: { color: '#e5e7eb' }
                }
            },
            scales: {
                x: { 
                    ticks: { color: '#9ca3af' },
                    grid: { color: '#374151' }
                },
                y: { 
                    ticks: { color: '#9ca3af' },
                    grid: { color: '#374151' }
                }
            }
        }
    });

    // Role Efficiency Chart
    const roleEfficiencyCtx = document.getElementById('roleEfficiencyChart').getContext('2d');
    new Chart(roleEfficiencyCtx, {
        type: 'radar',
        data: {
            labels: ['Boomerang', 'Researcher', 'Architect', 'Developer', 'Code Review'],
            datasets: [{
                label: 'Efficiency %',
                data: [
                    {{multiply (default metrics.delegations.roleEfficiency.boomerang 0) 100}},
                    {{multiply (default metrics.delegations.roleEfficiency.researcher 0) 100}},
                    {{multiply (default metrics.delegations.roleEfficiency.architect 0) 100}},
                    {{multiply (default metrics.delegations.roleEfficiency.senior-developer 0) 100}},
                    {{multiply (default metrics.delegations.roleEfficiency.code-review 0) 100}}
                ],
                borderColor: '#3b82f6',
                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                pointBackgroundColor: '#3b82f6',
                pointBorderColor: '#1d4ed8',
                pointHoverBackgroundColor: '#1d4ed8',
                pointHoverBorderColor: '#3b82f6'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    labels: { color: '#e5e7eb' }
                }
            },
            scales: {
                r: {
                    angleLines: { color: '#374151' },
                    grid: { color: '#374151' },
                    pointLabels: { color: '#9ca3af' },
                    ticks: { 
                        color: '#9ca3af',
                        backdropColor: 'transparent'
                    },
                    min: 0,
                    max: 100
                }
            }
        }
    });
});
</script>
{{/inline}}

{{/layouts/base}}